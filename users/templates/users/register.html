{% extends 'main/base.html' %}
{% block title %}Register - FoodOrder{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 90vh;">
    <div class="card shadow-lg p-4"
        style="width: 100%; max-width: 500px; border: 2px solid #f15a24; border-radius: 20px;">
        <h3 class="text-center mb-4" style="color: #f15a24;">Create an Account</h3>
        <form method="POST">
            {% csrf_token %}

            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                {{ form.username }}
                {% if form.username.errors %}
                <div class="text-danger small">{{ form.username.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">Email Address</label>
                {{ form.email }}
                {% if form.email.errors %}
                <div class="text-danger small">{{ form.email.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="password1" class="form-label">Password</label>
                {{ form.password1 }}
                {% if form.password1.errors %}
                <div class="text-danger small">{{ form.password1.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="password2" class="form-label">Confirm Password</label>
                {{ form.password2 }}
                {% if form.password2.errors %}
                <div class="text-danger small">{{ form.password2.errors }}</div>
                {% endif %}
            </div>

            <button type="submit" class="btn w-100"
                style="background-color: #f15a24; color: white; border-radius: 25px;">Register</button>
        </form>

        <div class="text-center mt-3">
            <small>Already have an account? <a href="{% url 'login' %}" style="color: #f15a24;">Login here</a></small>
        </div>
    </div>
</div>

<script>

    document.getElementById('id_username').className = 'form-control';
    document.getElementById('id_email').className = 'form-control';
    document.getElementById('id_password1').className = 'form-control';
    document.getElementById('id_password2').className = 'form-control';

    document.getElementById('registerForm').addEventListener('submit', function (e) {
        let isValid = true;

       
        const clearErrors = () => {
            document.querySelectorAll('.js-error').forEach(el => el.remove());
        };
        clearErrors();

        const showError = (field, message) => {
            const error = document.createElement('div');
            error.className = 'text-danger small js-error';
            error.innerText = message;
            field.parentNode.appendChild(error);
        };

        const username = document.getElementById('id_username');
        const email = document.getElementById('id_email');
        const password1 = document.getElementById('id_password1');
        const password2 = document.getElementById('id_password2');

        if (username.value.trim() === '') {
            showError(username, 'Username is required.');
            isValid = false;
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email.value.trim())) {
            showError(email, 'Please enter a valid email address.');
            isValid = false;
        }

        if (password1.value.length < 8) {
            showError(password1, 'Password must be at least 8 characters.');
            isValid = false;
        }

        if (password1.value !== password2.value) {
            showError(password2, 'Passwords do not match.');
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault(); 
        }
    });


</script>
{% endblock %}